# Detect terminal capabilities
if [ -t 1 ] && command -v tput > /dev/null 2>&1 && tput colors > /dev/null 2>&1; then
    # Colors for better visual output
    RED=$(tput setaf 1)
    GREEN=$(tput setaf 2)
    YELLOW=$(tput setaf 3)
    BLUE=$(tput setaf 4)
    PURPLE=$(tput setaf 5)
    CYAN=$(tput setaf 6)
    WHITE=$(tput setaf 7; tput bold)
    NC=$(tput sgr0) # No Color
else
    # No colors for basic terminals
    RED=''
    GREEN=''
    YELLOW=''
    BLUE=''
    PURPLE=''
    CYAN=''
    WHITE=''
    NC=''
fi

# Header with project name
echo "${PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo "${PURPLE}â•‘                    ${WHITE}ğŸ¯ PIVOT PRE-COMMIT${PURPLE}                    â•‘${NC}"
echo "${PURPLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""

# Check for staged files first
if git diff --cached --quiet; then
    echo "${RED}âŒ Aucun fichier stagÃ© trouvÃ© !${NC}"
    echo "${YELLOW}ğŸ’¡ Utilisez 'git add <fichiers>' avant de commiter${NC}"
    exit 1
fi

echo "${CYAN}ğŸš€ DÃ©marrage des vÃ©rifications pre-commit...${NC}"
echo ""

# Show what files are being processed
echo "${BLUE}ğŸ“‹ Fichiers Ã  traiter :${NC}"
git diff --cached --name-only | sed 's/^/  â€¢ /'
echo ""

# Run lint-staged with better visual feedback
echo "${PURPLE}ğŸ” ExÃ©cution des vÃ©rifications automatiques...${NC}"
echo ""

if npx lint-staged; then
    echo ""
    echo "${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo "${GREEN}â•‘                   ${WHITE}âœ… SUCCÃˆS !${GREEN}                          â•‘${NC}"
    echo "${GREEN}â•‘            Toutes les vÃ©rifications ont rÃ©ussi           â•‘${NC}"
    echo "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
else
    echo ""
    echo "${RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo "${RED}â•‘                    ${WHITE}âŒ Ã‰CHEC !${RED}                           â•‘${NC}"
    echo "${RED}â•‘               Des erreurs ont Ã©tÃ© dÃ©tectÃ©es              â•‘${NC}"
    echo "${RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    exit 1
fi
